<p-toast [style]="{marginTop: '80px'}" life="3000"></p-toast>
<div class="container pt-5 mt-5">
    <div class="row m-1">
        <h1>Mantenimiento de Usuario</h1>
        <ng-container *ngFor="let permiso of misPermisos">
            <div *ngIf="permiso.Descripcion_Seccion === 'Agregar' && permiso.Estado === 'A'" class="col-md-12 m-1">
                <button type="button" class="btn btn-raised btn-info" data-toggle="modal" data-target="#createModal">
                    Agregar
                </button>
            </div>
        </ng-container>
        <p-confirmDialog [style]="{width: '50vw'}"></p-confirmDialog>
        <!-- <div class="col-md-12 table-responsive">
            <ng-container *ngFor="let permiso of misPermisos">
                <table *ngIf="permiso.Descripcion_Seccion === 'Lista' && permiso.Estado === 'A' " class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Usuario</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Correo Electronico</th>
                            <th scope="col">Estado</th>
                            <ng-container *ngFor="let permiso2 of misPermisos">
                                <th *ngIf="permiso2.Descripcion_Seccion === 'Editar' && permiso2.Estado === 'A' " scope="col">Editar</th>
                                <th *ngIf="permiso2.Descripcion_Seccion === 'Detalles' && permiso2.Estado === 'A' " scope="col">Ver Detalles</th>
                            </ng-container>
                            
                            
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let usr of usuarios">
                            <tr>
                                <th scope="row">{{ usr.Usuario }}</th>
                                <td>{{ usr.Nombre }}</td>
                                <td>{{ usr.Correo_Electronico }}</td>
                                <td *ngIf="usr.Estado === 'A'">Activo</td>
                                <td *ngIf="usr.Estado === 'I'">Inactivo</td>
                                <ng-container *ngFor="let permiso2 of misPermisos">
                                    <td *ngIf="permiso2.Descripcion_Seccion === 'Editar' && permiso2.Estado === 'A' ">
                                        <button type="button" (click)="onButtonEditClick(usr)"
                                            class="btn btn-raised btn-warning" data-toggle="modal" data-target="#editModal">
                                            Editar
                                        </button>
                                    </td>
                                    <td *ngIf="permiso2.Descripcion_Seccion === 'Detalles' && permiso2.Estado === 'A' ">
                                        <button type="button" (click)="onDetailsClick(usr)"
                                            class="btn btn-raised btn-success" data-toggle="modal"
                                            data-target="#detailsModal">
                                            Ver Detalles
                                        </button>
                                    </td>
                                </ng-container>
                                
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </ng-container>
        </div> -->
        <div class="col-md-12">
            <p-table [value]="usuarios" [paginator]="true" [rows]="10" [responsive]="true">
                <ng-template pTemplate="header">
                    <tr>
                        <th scope="col">Usuario</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Correo Electronico</th>
                        <th scope="col">Estado</th>
                        <ng-container *ngFor="let permiso2 of misPermisos">
                            <ng-container *ngIf="permiso2.Descripcion_Seccion === 'Editar' && permiso2.Estado === 'A' ">
                                <th scope="col"></th>
                            </ng-container>
                            <ng-container *ngIf="permiso2.Descripcion_Seccion === 'Detalles' && permiso2.Estado === 'A' ">
                                <th scope="col"></th>
                            </ng-container>
                        </ng-container>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-usr>
                    <tr>
                        <td><span class="ui-column-title">Usuario</span>{{ usr.Usuario }}</td>
                        <td><span class="ui-column-title">Nombre</span>{{ usr.Nombre }}</td>
                        <td><span class="ui-column-title">Correo</span>{{ usr.Correo_Electronico }}</td>
                        <td> <span class="ui-column-title">Estado</span> {{ usr.Estado=='A'?'Activo':'Inactivo' }}</td>
                        <ng-container *ngFor="let permiso2 of misPermisos">
                            <ng-container *ngIf="permiso2.Descripcion_Seccion === 'Editar' && permiso2.Estado === 'A' ">
                                <td><button (click)="onButtonEditClick(usr)" type="button" class="btn btn-raised btn-warning" data-toggle="modal" data-target="#editModal">Editar</button></td>
                            </ng-container>
                            <ng-container *ngIf="permiso2.Descripcion_Seccion === 'Detalles' && permiso2.Estado === 'A' ">
                                <td><button (click)="onDetailsClick(usr)" type="button" class="btn btn-raised btn-warning" data-toggle="modal" data-target="#detailsModal">Ver detalles</button></td>
                            </ng-container>
                        </ng-container>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <ng-container *ngFor="let permiso of misPermisos">
            <div *ngIf="permiso.Descripcion_Seccion === 'Agregar' && permiso.Estado === 'A'" class="modal fade" id="createModal" tabindex="-1" role="dialog" aria-labelledby="createUser" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="createUser">Crear Usuario</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <form #UsuarioForm="ngForm" (ngSubmit)="onSubmit()" autocomplete="off">
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="usuarioI">Usuario</label>
                                    <input id="usuarioI" class="form-control" name="usuarioI" [(ngModel)]="usuario.Usuario" />
                                </div>
                                <div class="form-group">
                                    <label for="contrasennaI">Contraseña</label>
                                    <input id="contrasennaI" class="form-control" name="contrasennaI" [(ngModel)]="usuario.Contrasenna" type="password" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label for="nombreI">Nombre</label>
                                    <input id="nombreI" class="form-control" name="nombreI" [(ngModel)]="usuario.Nombre" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label for="emailI">Correo Electronico</label>
                                    <input id="emailI" class="form-control" name="emailI" [(ngModel)]="usuario.Correo_Electronico" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label for="telefonoI">Telefono</label>
                                    <input id="telefonoI" class="form-control" name="telefonoI" [(ngModel)]="usuario.Telefono" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label for="estadoI">Estado</label>
                                    <select class="form-control" id="estado" name="estado" [(ngModel)]="usuario.Estado">
                                        <option value="A">Activo</option>
                                        <option value="I">Inactivo</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="rolI">Rol</label>
                                    <select class="form-control" id="estado" name="estado" [(ngModel)]="usuario.Rol">
                                        <ng-container *ngFor="let rol of roles">
                                            <option [value]="rol.ID">{{ rol.Descripcion }}</option>
                                        </ng-container>
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-raised btn-danger m-1" data-dismiss="modal">
                                    Cerrar
                                </button>
                                <button type="submit" (click)="onSubmit();" class="btn btn-raised btn-success m-1" data-dismiss="modal">
                                    Guardar
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div *ngIf="permiso.Descripcion_Seccion === 'Editar' && permiso.Estado === 'A'" class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editUser" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editUser">Editar Usuario</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <form #UsuarioForm="ngForm" (ngSubmit)="onSubmitEdit()">
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="usuarioI">Usuario</label>
                                    <input id="usuarioI" class="form-control" name="usuarioI" [(ngModel)]="myUsr.Usuario" />
                                </div>
                                <div class="form-group">
                                    <label for="contrasennaI">Contraseña</label>
                                    <input id="contrasennaI" class="form-control" name="contrasennaI" [(ngModel)]="myUsr.Contrasenna" type="password" />
                                </div>
                                <div class="form-group">
                                    <label for="nombreI">Nombre</label>
                                    <input id="nombreI" class="form-control" name="nombreI" [(ngModel)]="myUsr.Nombre" />
                                </div>
                                <div class="form-group">
                                    <label for="emailI">Correo Electronico</label>
                                    <input id="emailI" class="form-control" name="emailI" [(ngModel)]="myUsr.Correo_Electronico" />
                                </div>
                                <div class="form-group">
                                    <label for="telefonoI">Telefono</label>
                                    <input id="telefonoI" class="form-control" name="telefonoI" [(ngModel)]="myUsr.Telefono" />
                                </div>
                                <div class="form-group">
                                    <label for="estadoI">Estado</label>
                                    <select class="form-control" id="estado" name="estado" [(ngModel)]="myUsr.Estado">
                                    <option value="A">Activo</option>
                                    <option value="I">Inactivo</option>
                                </select>
                                </div>
                                <div class="form-group">
                                    <label for="rolI">Rol</label>
                                    <select class="form-control" id="estado" name="estado" [(ngModel)]="myUsr.Rol">
                                    <ng-container *ngFor="let rol of roles">
                                        <option [value]="rol.ID">{{ rol.Descripcion }}</option>
                                    </ng-container>
                                </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-raised btn-danger m-1" data-dismiss="modal">
                                Cerrar
                            </button>
                                <button type="submit" class="btn btn-raised btn-success m-1">
                                Guardar
                            </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div *ngIf="permiso.Descripcion_Seccion === 'Detalles' && permiso.Estado === 'A'" class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailUser" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="detailUser">
                                {{ usuarioDetalle.Nombre }}
                            </h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="usuario">Usuario</label>
                                <input id="usuario" class="form-control" [(ngModel)]="usuarioDetalle.Usuario" disabled />
                            </div>
                            <div class="form-group">
                                <label for="nombre">Nombre</label>
                                <input id="nombre" class="form-control" [(ngModel)]="usuarioDetalle.Nombre" disabled />
                            </div>
                            <div class="form-group">
                                <label for="email">Correo Electronico</label>
                                <input id="email" class="form-control" [(ngModel)]="usuarioDetalle.Correo_Electronico" disabled />
                            </div>
                            <div class="form-group">
                                <label for="telefono">Teléfono</label>
                                <input id="telefono" class="form-control" [(ngModel)]="usuarioDetalle.Telefono" disabled />
                            </div>
                            <div class="form-group bmd-form-group">
                                <label class="bmd-label-static" for="miEstado">Estado</label>
                                <input *ngIf="usuarioDetalle.Estado === 'A'" id="miEstado" class="form-control" value="Activo" disabled />
                                <input *ngIf="usuarioDetalle.Estado === 'I'" id="miEstado" class="form-control" value="Inactivo" disabled />
                            </div>
                            <div class="form-group bmd-form-group">
                                <label class="bmd-label-static" for="miRol">Rol</label>
                                <input *ngIf="rol !== undefined" id="miRol" class="form-control" [(ngModel)]="rol.Descripcion" disabled />
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-raised btn-danger m-1" data-dismiss="modal">
                            Cerrar
                        </button>
                        </div>
                    </div>
                </div>
            </div>

        </ng-container>




    </div>
</div>